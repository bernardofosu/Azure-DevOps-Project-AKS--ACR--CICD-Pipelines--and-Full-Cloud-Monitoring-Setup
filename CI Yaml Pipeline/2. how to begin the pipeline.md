
# ğŸŸ¦ Azure DevOps Pipeline Structure â€” Full Guide with Emojis + YAML

This file explains **exactly how every Azure DevOps pipeline should be structured**, including:

âœ” Global pipeline header  
âœ” Stage â†’ Job â†’ Steps structure  
âœ” When to use tasks vs scripts  
âœ” FULL YAML examples  

---

# ğŸŸ¦ 1ï¸âƒ£ GLOBAL PIPELINE HEADER (Always at the top)

This section **appears once** in every pipeline:

```yaml
trigger:
  - none

pool:
  name: nakodtech
  demands:
    - agent.name -equals Agent-1

stages:
```

### ğŸ“ Meaning:
- **trigger: none** â†’ pipeline will not auto-run  
- **pool:** selects selfâ€‘hosted agent  
- **stages:** begins multi-stage pipeline  

---

# ğŸŸ¦ 2ï¸âƒ£ EVERY STAGE FOLLOWS THIS PATTERN

```yaml
- stage: <stage_name>
  displayName: "<Readable Stage Name>"
  jobs:
    - job: <job_name>
      displayName: "<Readable Job Name>"
      steps:
        - task: <azure-task>   # or script
```

âœ” Stage groups jobs  
âœ” Job groups steps  
âœ” Steps contain tasks or scripts  

---

# ğŸŸ¦ 3ï¸âƒ£ YOU CAN USE TASK-ASSISTANT TASKS OR SCRIPTS

### ğŸŸ© Option A â€” Use Azure DevOps Tasks (Recommended)
Examples:
- Maven@4  
- Docker@2  
- PublishBuildArtifacts@1  
- DownloadBuildArtifacts@0  
- SonarQubePrepare@7  
- CmdLine@2  

### ğŸŸ§ Option B â€” Use Raw Script Steps
Examples:
```yaml
- script: mvn package
- script: trivy fs ...
- script: trivy image ...
```

---

# ğŸŸ¦ 4ï¸âƒ£ FULL PIPELINE TEMPLATE â€” WITH ALL YAML INCLUDED

Below is a **complete pipeline** showing every stage structure properly.

---

## ğŸŸ© **GLOBAL HEADER**

```yaml
trigger:
  - none

pool:
  name: nakodtech
  demands:
    - agent.name -equals Agent-1

stages:
```

---

## ğŸŸ¦ **1ï¸âƒ£ Stage: Compile**

```yaml
- stage: compile
  displayName: "Maven Compile"
  jobs:
    - job: maven_compile
      displayName: "Maven Compile Job"
      steps:
        - task: Maven@4
          inputs:
            mavenPomFile: 'pom.xml'
            goals: 'compile'
            publishJUnitResults: true
            testResultsFiles: '**/surefire-reports/TEST-*.xml'
```

---

## ğŸŸ¦ **2ï¸âƒ£ Stage: Test**

```yaml
- stage: test
  displayName: "Maven Test"
  jobs:
    - job: maven_test
      displayName: "Maven Test Job"
      steps:
        - task: Maven@4
          inputs:
            mavenPomFile: 'pom.xml'
            goals: 'test'
            publishJUnitResults: true
            testResultsFiles: '**/surefire-reports/TEST-*.xml'
```

---

## ğŸŸ¦ **3ï¸âƒ£ Stage: Trivy FS Scan**

```yaml
- stage: trivy_fs_scan
  displayName: "Trivy Filesystem Scan"
  jobs:
    - job: trivy_scan_job
      displayName: "Trivy FS Scan Job"
      steps:
        - task: CmdLine@2
          inputs:
            script: "trivy fs --format table -o trivy-fs-report.txt ."
```

---

## ğŸŸ¦ **4ï¸âƒ£ Stage: SonarQube Scan**

```yaml
- stage: sonarqube_scan
  displayName: "SonarQube Scan"
  jobs:
    - job: sonar_scan_job
      displayName: "Sonar Analyze Job"
      steps:
        - task: SonarQubePrepare@7
          inputs:
            SonarQube: "sonarqube-conn"
            scannerMode: "cli"
            configMode: "manual"
            cliProjectKey: "bankapp"
            cliProjectName: "bankapp for sonar"
            cliSources: "."
            extraProperties: |
              sonar.java.libraries=.
              sonar.java.binaries=target/classes

        - task: SonarQubeAnalyze@7
          inputs:
            jdkversion: "JAVA_HOME"
```

---

## ğŸŸ¦ **5ï¸âƒ£ Stage: Build (Package JAR)**

```yaml
- stage: build
  displayName: "Build Stage"
  jobs:
    - job: build_job
      displayName: "Build / Package Job"
      steps:
        - script: mvn package
          displayName: "Package Application"

        - task: PublishBuildArtifacts@1
          displayName: "Publish JAR Artifact"
          inputs:
            pathToPublish: "target"
            artifactName: "drop"
```

---

## ğŸŸ¦ **6ï¸âƒ£ Stage: Docker Build & Push**

```yaml
- stage: docker_build_push
  displayName: "Docker Build & Push"
  jobs:
    - job: build_push_job
      displayName: "Docker Build Job"
      steps:
        - task: DownloadBuildArtifacts@0
          displayName: "Download JAR Artifact"
          inputs:
            artifactName: "drop"
            downloadPath: "$(Build.SourcesDirectory)"

        - task: Docker@2
          displayName: "Docker Build and Push"
          inputs:
            containerRegistry: "docker-conn"
            repository: "bofosu1/bankapp2"
            command: "buildAndPush"
            Dockerfile: "**/Dockerfile"
```

---

## ğŸŸ¦ **7ï¸âƒ£ Stage: Trivy Image Scan**

```yaml
- stage: trivy_image_scan
  displayName: "Trivy Image Scan"
  jobs:
    - job: trivy_image_scan_job
      displayName: "Image Scan Job"
      steps:
        - script: "trivy image --format table -o trivy-image-report.txt bofosu1/bankapp2:18"
          displayName: "Trivy Image Scan"
```

---

# ğŸŸ¦ FINAL SUMMARY â€” ALWAYS FOLLOW THIS STRUCTURE

âœ” Global header once  
âœ” Each stage = stage â†’ job â†’ steps  
âœ” Steps = tasks or scripts  
âœ” Pool at top is enough  
âœ” Tasks come from UI  
âœ” Script is used when no task exists  

---

If you want, I can also make:  
âœ¨ **A visual diagram** of this full pipeline  
ğŸ“˜ **A PDF version**  
ğŸ§± **A reusable template version**  
